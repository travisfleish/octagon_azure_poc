# Azure Search Index for Parsed SOW Data

This directory contains scripts and tools for creating and querying an Azure Search index populated with structured SOW (Statement of Work) data from the parsed JSON container.

## Overview

The Azure Search index provides powerful search capabilities across structured SOW data including:
- Client names and project titles
- Project timelines and durations
- Scope summaries and deliverables
- Staffing plans and roles
- Exclusions and requirements

## Files

### Core Scripts

1. **`create_parsed_sows_index.py`** - Main script to create and populate the Azure Search index
   - Creates the `octagon-sows-parsed` index with 12 searchable fields
   - Downloads parsed JSON files from Azure Storage `parsed` container
   - Transforms and uploads data to the search index
   - Supports both creating new indexes and recreating existing ones

2. **`query_parsed_sows_index.py`** - Interactive query interface for the search index
   - Provides multiple search options (by client, project, staffing, etc.)
   - Displays results in a formatted, readable format
   - Supports filtering and custom queries

3. **`test_search.py`** - Simple test script to verify search functionality
   - Tests basic search operations
   - Validates search results and formatting

### Utility Scripts

4. **`list_azure_search_indexes.py`** - Lists all existing Azure Search indexes
5. **`detailed_index_info.py`** - Provides detailed information about index structure

## Index Schema

The `octagon-sows-parsed` index contains the following fields:

| Field | Type | Searchable | Filterable | Sortable | Facetable | Description |
|-------|------|------------|------------|----------|-----------|-------------|
| `id` | Edm.String | No | Yes | Yes | No | Unique document identifier (KEY) |
| `client_name` | Edm.String | Yes | Yes | Yes | Yes | Client company name |
| `project_title` | Edm.String | Yes | Yes | Yes | No | Project title/name |
| `start_date` | Edm.String | No | Yes | Yes | No | Project start date |
| `end_date` | Edm.String | No | Yes | Yes | No | Project end date |
| `project_length` | Edm.String | Yes | Yes | Yes | Yes | Project duration |
| `scope_summary` | Edm.String | Yes | No | No | No | Project scope description |
| `deliverables` | Collection(Edm.String) | Yes | No | No | No | List of project deliverables |
| `exclusions` | Collection(Edm.String) | Yes | No | No | No | List of project exclusions |
| `staffing_plan` | Collection(Edm.String) | Yes | No | No | No | Staffing assignments and roles |
| `file_name` | Edm.String | Yes | Yes | Yes | No | Original SOW file name |
| `extraction_timestamp` | Edm.String | No | Yes | Yes | No | When the data was extracted |

## Usage

### Prerequisites

1. Azure Search service configured with appropriate keys
2. Azure Storage account with `parsed` container containing JSON files
3. Environment variables set in `.env` file:
   ```
   SEARCH_ENDPOINT=https://your-search-service.search.windows.net
   SEARCH_KEY=your-search-key
   AZURE_STORAGE_ACCOUNT_URL=https://your-storage-account.blob.core.windows.net
   ```

### Creating the Index

```bash
python3 create_parsed_sows_index.py
```

Options:
- **Option 1**: Create new index (fails if index already exists)
- **Option 2**: Recreate index (deletes existing and creates new)

### Querying the Index

```bash
python3 query_parsed_sows_index.py
```

Interactive search options:
1. Search by client name
2. Search by project title
3. Search by staffing role
4. Search by deliverable
5. Search by date range
6. Search by project length
7. Get all documents
8. Custom search

### Testing Search Functionality

```bash
python3 test_search.py
```

## Search Examples

### Search by Client
```python
# Find all SOWs for "Company 2"
results = manager.search_by_client("Company 2")
```

### Search by Project Type
```python
# Find hospitality-related projects
results = manager.search_by_project_title("hospitality")
```

### Search by Staffing Role
```python
# Find projects with Project Management roles
results = manager.search_by_staffing_role("Project Management")
```

### Search by Date Range
```python
# Find projects in 2025
results = manager.search_by_date_range("2025-01-01", "2025-12-31")
```

## Current Status

✅ **Index Created**: `octagon-sows-parsed` index successfully created  
✅ **Data Populated**: 10 SOW documents indexed from parsed JSON files  
✅ **Search Functional**: All search operations working correctly  
✅ **Interactive Interface**: Query interface ready for use  

## Data Sources

The index is populated from the Azure Storage `parsed` container, which contains JSON files generated by the SOW extraction process. Each JSON file contains structured data extracted from SOW documents including:

- Client information
- Project details and timelines
- Scope and deliverables
- Staffing plans
- Exclusions and requirements

## Next Steps

1. **Integration with Streamlit App**: Connect the search functionality to the main Streamlit interface
2. **Advanced Search Features**: Add faceted search, sorting, and filtering options
3. **Search Analytics**: Track search patterns and popular queries
4. **Auto-refresh**: Automatically update index when new SOWs are processed
5. **Search Suggestions**: Add autocomplete and search suggestions

## Troubleshooting

### Common Issues

1. **Authentication Errors**: Verify `SEARCH_KEY` and `SEARCH_ENDPOINT` in `.env` file
2. **Storage Access**: Ensure `AZURE_STORAGE_ACCOUNT_URL` is correct and accessible
3. **Index Not Found**: Run the index creation script first
4. **Empty Results**: Check if parsed JSON files exist in the `parsed` container

### Debug Commands

```bash
# List all indexes
python3 list_azure_search_indexes.py

# Test search functionality
python3 test_search.py

# Get detailed index information
python3 detailed_index_info.py
```
